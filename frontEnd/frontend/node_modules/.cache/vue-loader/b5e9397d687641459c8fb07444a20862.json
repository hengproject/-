{"remainingRequest":"C:\\DATA\\projects\\数据库实习\\frontEnd\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\DATA\\projects\\数据库实习\\frontEnd\\frontend\\src\\components\\manager\\CatInfo.vue?vue&type=style&index=0&id=f9fcf37c&scoped=true&lang=css&","dependencies":[{"path":"C:\\DATA\\projects\\数据库实习\\frontEnd\\frontend\\src\\components\\manager\\CatInfo.vue","mtime":1635172257664},{"path":"C:\\DATA\\projects\\数据库实习\\frontEnd\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1630488425476},{"path":"C:\\DATA\\projects\\数据库实习\\frontEnd\\frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1630488427380},{"path":"C:\\DATA\\projects\\数据库实习\\frontEnd\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1630488425847},{"path":"C:\\DATA\\projects\\数据库实习\\frontEnd\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1630488426001},{"path":"C:\\DATA\\projects\\数据库实习\\frontEnd\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1630488426239}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5kcmF3ZXItZm9ybSB7CiAgd2lkdGg6IDUwJTsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoNTAlKTsKfQouZm9ybS11cGxvYWQgewogIHdpZHRoOiAxMHZ3OwogIGhlaWdodDogMTAwJTsKICBib3JkZXI6IDFweCBkYXNoZWQgI2Q5ZDlkOTsKICBib3JkZXItcmFkaXVzOiA2cHg7CiAgY3Vyc29yOiBwb2ludGVyOwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBvdmVyZmxvdzogaGlkZGVuOwp9Ci5hdmF0YXItdXBsb2FkZXItaWNvbiB7CiAgZm9udC1zaXplOiAyOHB4OwogIGNvbG9yOiAjOGM5MzlkOwogIHdpZHRoOiAxNzhweDsKICBoZWlnaHQ6IDE3OHB4OwogIGxpbmUtaGVpZ2h0OiAxNzhweDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KLmRyYXdlci1idXR0b24tZ3JvdXAgewp9Cg=="},{"version":3,"sources":["CatInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CatInfo.vue","sourceRoot":"src/components/manager","sourcesContent":["<template>\n  <div>\n    <el-breadcrumb separator=\"/\">\n      <el-breadcrumb-item :to=\"{ path: '/home' }\">首页</el-breadcrumb-item>\n      <el-breadcrumb-item>管理员菜单</el-breadcrumb-item>\n      <el-breadcrumb-item>猫猫档案</el-breadcrumb-item>\n    </el-breadcrumb>\n\n    <el-card>\n      <el-row :gutter=\"20\">\n        <el-col :span=\"7\">\n          <el-button type=\"primary\" @click=\"showAddDialog\"\n            >添加猫咪信息</el-button\n          >\n        </el-col>\n      </el-row>\n      <el-table :data=\"catList\" border stripe>\n        <el-table-column label=\"主要信息\" align=\"center\">\n          <el-table-column label=\"照片\">\n            <template #default=\"scope\" :config=\"config\">\n              <img\n                :src=\"\n                  `${config.Http.baseUrl}` +\n                  'image?imgId=' +\n                  `${scope.row.catPhotoId}`\n                \"\n                style=\"width: 100%\"\n                v-if=\"scope.row.catPhotoId\"\n              />\n            </template>\n          </el-table-column>\n          <el-table-column label=\"ID\" prop=\"catId\"></el-table-column>\n          <el-table-column label=\"猫名\" prop=\"catName\"></el-table-column>\n          <el-table-column label=\"猫性别\">\n            <template #default=\"scope\">\n              {{ scope.row.catSex == 0 ? \"雄\" : \"雌\" }}\n            </template>\n          </el-table-column>\n          <el-table-column label=\"猫状态\" prop=\"catStatus\"></el-table-column>\n          <el-table-column label=\"备注\" prop=\"catRemark\"></el-table-column>\n        </el-table-column>\n\n        <el-table-column label=\"记录\" align=\"center\">\n          <el-table-column label=\"校区\" prop=\"campusName\"></el-table-column>\n          <el-table-column label=\"区域\" prop=\"areaName\"></el-table-column>\n        </el-table-column>\n        <el-table-column label=\"时间\" align=\"center\">\n          <el-table-column label=\"最后发现时间\">\n            <template #default=\"scope\" :getLocalTime=\"this.getLocalTime\">\n              {{ getLocalTime(scope.row.lastFindTime) }}\n            </template>\n          </el-table-column>\n          <el-table-column label=\"修改时间\">\n            <template #default=\"scope\" :getLocalTime=\"this.getLocalTime\">\n              {{ getLocalTime(scope.row.updateTime) }}\n            </template>\n          </el-table-column>\n          <el-table-column label=\"创建时间\">\n            <template #default=\"scope\" :getLocalTime=\"this.getLocalTime\">\n              {{ getLocalTime(scope.row.createTime) }}\n            </template>\n          </el-table-column>\n          <el-table-column label=\"操作\">\n            <template slot-scope=\"scope\">\n              <el-button-group>\n                <el-tooltip\n                  class=\"item\"\n                  effect=\"dark\"\n                  content=\"修改猫咪信息\"\n                  placement=\"top\"\n                  :enterable=\"false\"\n                >\n                  <el-button\n                    type=\"primary\"\n                    icon=\"el-icon-edit\"\n                    size=\"mini\"\n                    @click=\"showEditDialog(scope.row)\"\n                  ></el-button\n                ></el-tooltip>\n                <el-tooltip\n                  class=\"item\"\n                  effect=\"dark\"\n                  content=\"删除该用户(包括员工信息)\"\n                  placement=\"top\"\n                  :enterable=\"false\"\n                >\n                  <el-button\n                    type=\"danger\"\n                    icon=\"el-icon-delete\"\n                    size=\"mini\"\n                    @click=\"deleteCat(scope.row)\"\n                  ></el-button\n                ></el-tooltip>\n              </el-button-group>\n            </template>\n          </el-table-column>\n        </el-table-column>\n      </el-table>\n      <el-pagination\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n        :current-page=\"queryInfo.pageNum + 1\"\n        :page-sizes=\"[2, 3, 5, 10]\"\n        :page-size=\"queryInfo.pageSize\"\n        :total=\"total\"\n        layout=\"total,sizes, prev, pager, next, jumper\"\n      >\n      </el-pagination>\n    </el-card>\n\n    <!--    修改动物信息对话框-->\n    <el-drawer title=\"修改信息\" :visible.sync=\"editDialogVisible\" size=\"67%\">\n      <!--      内容主题区-->\n\n      <el-form :model=\"editForm\" ref=\"editFormRef\" class=\"drawer-form\">\n        <el-form-item label=\"ID\">\n          <el-input v-model=\"editForm.catId\" :disabled=\"true\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"照片\">\n          <br />\n          <el-upload\n            class=\"form-upload\"\n            ref=\"uploadCatPictureRef\"\n            :action=\"pictureUploadAddr\"\n            :auto-upload=\"false\"\n            :data=\"{ catId: editForm.catId }\"\n            :on-change=\"onChange\"\n            :show-file-list=\"false\"\n          >\n            <img\n              v-if=\"editForm.catPhotoSrc || editForm.catPhotoId\"\n              :src=\"this.editForm.photoAddr\"\n              style=\"width: 100%\"\n            />\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n          </el-upload>\n        </el-form-item>\n        <el-form-item label=\"名字\" prop=\"catName\">\n          <el-input\n            v-model=\"editForm.catName\"\n            placeholder=\"请输入名称\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"性别\" prop=\"catSex\">\n          <br />\n          <el-select v-model=\"editForm.catSex\">\n            <el-option label=\"雄性\" :value=\"0\"></el-option>\n            <el-option label=\"雌性\" :value=\"1\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"年龄\" prop=\"catAge\">\n          <el-input\n            v-model=\"editForm.catAge\"\n            placeholder=\"请输入年龄\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"备注\" prop=\"catRemark\">\n          <el-input\n            v-model=\"editForm.catRemark\"\n            placeholder=\"请输入备注\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"状态\" prop=\"catStatus\">\n          <el-input\n            v-model=\"editForm.catStatus\"\n            placeholder=\"请输入当前状态\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"校区\">\n          <br />\n          <el-select @change=\"editCampusChange\" v-model=\"editForm.campusId\">\n            <el-option\n              :key=\"campus.campusId\"\n              :label=\"campus.campusName\"\n              :value=\"campus.campusId\"\n              v-for=\"campus in campusForm\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"活动区域\">\n          <br />\n          <el-select v-model=\"editForm.areaId\" :placeholder=\"editForm.areaName\">\n            <el-option\n              :key=\"area.campusId\"\n              :label=\"area.campusName\"\n              :value=\"area.campusId\"\n              v-for=\"area in areaForm\"\n              @change=\"editAreaChange\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n      </el-form>\n\n      <span class=\"drawer-button-group\">\n        <el-button @click=\"editDialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitEditForm\">确 定</el-button>\n      </span>\n    </el-drawer>\n\n    <!--    添加动物信息对话框-->\n    <el-drawer title=\"增加信息\" :visible.sync=\"addCatDialogVisible\" size=\"67%\">\n      <!--      内容主题区-->\n\n      <el-form :model=\"editForm\" ref=\"addFormRef\" class=\"drawer-form\">\n        <el-form-item label=\"ID\">\n          <el-input v-model=\"editForm.catId\" :disabled=\"true\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"照片\">\n          <br />\n          <el-upload\n            class=\"form-upload\"\n            ref=\"uploadCatPictureRef\"\n            :action=\"pictureUploadAddr\"\n            :auto-upload=\"false\"\n            :data=\"{ catId: this.temp.catId4Img}\"\n            :on-change=\"onChange\"\n            :show-file-list=\"false\"\n          >\n            <img\n              v-if=\"editForm.catPhotoSrc || editForm.catPhotoId\"\n              :src=\"this.editForm.photoAddr\"\n              style=\"width: 100%\"\n            />\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n          </el-upload>\n        </el-form-item>\n        <el-form-item label=\"名字\" prop=\"catName\">\n          <el-input\n            v-model=\"editForm.catName\"\n            placeholder=\"请输入名称\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"性别\" prop=\"catSex\">\n          <br />\n          <el-select v-model=\"editForm.catSex\">\n            <el-option label=\"雄性\" :value=\"0\"></el-option>\n            <el-option label=\"雌性\" :value=\"1\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"年龄\" prop=\"catAge\">\n          <el-input\n            v-model=\"editForm.catAge\"\n            placeholder=\"请输入年龄\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"备注\" prop=\"catRemark\">\n          <el-input\n            v-model=\"editForm.catRemark\"\n            placeholder=\"请输入备注\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"状态\" prop=\"catStatus\">\n          <el-input\n            v-model=\"editForm.catStatus\"\n            placeholder=\"请输入当前状态\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"校区\">\n          <br />\n          <el-select @change=\"editCampusChange\" v-model=\"editForm.campusId\">\n            <el-option\n              :key=\"campus.campusId\"\n              :label=\"campus.campusName\"\n              :value=\"campus.campusId\"\n              v-for=\"campus in campusForm\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"活动区域\">\n          <br />\n          <el-select v-model=\"editForm.areaId\" :placeholder=\"editForm.areaName\">\n            <el-option\n              :key=\"area.campusId\"\n              :label=\"area.campusName\"\n              :value=\"area.campusId\"\n              v-for=\"area in areaForm\"\n              @change=\"editAreaChange\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n      </el-form>\n\n      <span class=\"drawer-button-group\">\n        <el-button @click=\"addCatDialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitAddForm\">确 定</el-button>\n      </span>\n    </el-drawer>\n  </div>\n</template>\n\n<script>\nimport respFilter from \"@/components/utils/respFilter\";\nimport config from \"@/config\";\nimport copyProperties from \"@/components/utils/copyProperties\";\n\nexport default {\n  name: \"CatInfo\",\n  data() {\n    return {\n      pictureUploadAddr: config.Http.baseUrl + \"/manager_upload_file\",\n      catList: [],\n      queryInfo: {\n        query: \"\",\n        pageNum: 0,\n        pageSize: 2,\n      },\n      total: 0,\n      config,\n      editDialogVisible: false,\n      editForm: {\n        catId: -1,\n        catAge: -1,\n        catName: \"-1\",\n        catPhotoId: null,\n        catRemark: \"-1\",\n        catSex: -1,\n        catStatus: \"-1\",\n        campusId: \"-1\",\n        areaId: -1,\n        catPhotoSrc: null,\n        photoAddr: null,\n        areaIdTemp: null,\n      },\n      campusForm: [],\n      areaForm: [],\n      uploadEditForm: {\n        catId: \"-1\",\n        catAge: -1,\n        catName: \"-1\",\n        catRemark: \"-1\",\n        catSex: -1,\n        catStatus: \"-1\",\n        campusId: \"-1\",\n        areaId: -1,\n      },\n      addCatDialogVisible: false,\n      temp:{\n        catId4Img: null,\n      }\n    };\n  },\n  created() {\n    this.getCatList();\n    this.getAreaFormList();\n  },\n  methods: {\n    getLocalTime(nS) {\n      return new Date(parseInt(nS)).toLocaleString().replace(/:\\d{1,2}$/, \" \");\n    },\n    async getCatList() {\n      let { data: resp } = await this.$http.post(\n        \"/get_cat_information\",\n        this.queryInfo\n      );\n      if (!respFilter(resp)) {\n        this.$message.error(resp.msg);\n        this.logout();\n        return;\n      }\n      this.catList = resp.data.u;\n      this.total = resp.data.v;\n    },\n    //监听pagesize改变\n    handleSizeChange(newPageSize) {\n      this.queryInfo.pageSize = newPageSize;\n      this.getCatList();\n    },\n    handleCurrentChange(newPageNum) {\n      this.queryInfo.pageNum = newPageNum - 1;\n      this.getCatList();\n    },\n    async getAreaFormList() {\n      let { data: resp } = await this.$http.post(\n        \"/manager_get_basic_info_list\"\n      );\n      if (!respFilter(resp)) {\n        this.$message.error(resp.msg);\n        this.logout();\n        return;\n      }\n      this.campusForm = resp.data.campusList;\n    },\n    showEditDialog(row) {\n      this.editDialogVisible = true;\n      this.editForm = row;\n      this.editForm.campusId += \"\";\n      this.editForm.areaIdTemp = row.areaId;\n      this.editCampusChange(); //todo:提交时候别忘了如果为空\n      this.getEditPhotoAddr();\n\n      this.$forceUpdate();\n    },\n    async submitEditForm() {\n      if (!this.editForm.areaId)\n        this.editForm.areaId = this.editForm.areaIdTemp;\n      copyProperties(this.editForm, this.uploadEditForm);\n      this.$refs.uploadCatPictureRef.submit();\n      let { data: respForm } = await this.$http.post(\n        \"/manager_modify_cat_info\",\n        this.uploadEditForm\n      );\n      if (!respFilter(respForm)) {\n        this.$message.error(respForm.msg);\n        this.logout();\n        return;\n      }\n      this.$message.success(\"修改成功\");\n      this.editDialogVisible = false;\n      this.getCatList();\n    },\n    onChange(file) {\n      this.editForm.catPhotoSrc = URL.createObjectURL(file.raw);\n      this.getEditPhotoAddr();\n    },\n    getEditPhotoAddr() {\n      if (this.editForm.catPhotoSrc)\n        this.editForm.photoAddr = this.editForm.catPhotoSrc;\n      else\n        this.editForm.photoAddr =\n          `${config.Http.baseUrl}` +\n          \"image?imgId=\" +\n          `${this.editForm.catPhotoId}`;\n      this.$forceUpdate();\n    },\n    async editCampusChange() {\n      this.editForm.areaId = undefined;\n      await this.refreshAreaForm();\n    },\n    async refreshAreaForm() {\n      let { data: resp } = await this.$http.post(\n        \"/manager_get_basic_info_list_lazy_get_area\",\n        this.editForm.campusId\n      );\n      console.log(resp.data);\n      this.areaForm = resp.data;\n      this.areaForm.forEach((area) => {\n        area.campusId = area.campusId.split(\".\")[1];\n      });\n    },\n    editAreaChange() {\n      this.$forceUpdate();\n    },\n    showAddDialog() {\n      this.addCatDialogVisible = true;\n      this.editForm = {\n        catId: \"由后台自动生成\",\n        catAge: null,\n        catName: null,\n        catPhotoId: null,\n        catRemark: null,\n        catSex: null,\n        catStatus: null,\n        campusId: null,\n        areaId: null,\n        catPhotoSrc: null,\n        photoAddr: null,\n        areaIdTemp: null,\n      };\n    },\n    async submitAddForm() {\n      if (!this.editForm.areaId)\n        this.editForm.areaId = this.editForm.areaIdTemp;\n      copyProperties(this.editForm, this.uploadEditForm);\n      // this.uploadEditForm.areaId = null;\n      let { data: respForm } = await this.$http.post(\n        \"/manager_add_cat_info\",\n        this.uploadEditForm\n      );\n\n      this.temp.catId4Img = respForm.data;\n      this.$set(this.temp, \"catId4Img\", respForm.data);\n      if (!respFilter(respForm)) {\n        this.$message.error(respForm.msg);\n        this.logout();\n        return;\n      }\n      this.$nextTick(() => {\n        console.log(this.temp.catId4Img);\n        this.$refs.uploadCatPictureRef.submit();\n      });\n      this.$message.success(\"添加成功\");\n      this.addCatDialogVisible = false;\n      await this.getCatList();\n    },\n    async deleteCat(row){\n      let { data: resp } = await this.$http.post(\n        \"/manager_delete_cat_info\",\n        row.catId\n      );\n      if (!respFilter(resp)) {\n        this.$message.error(resp.msg);\n        this.logout();\n        return;\n      }\n      this.$message.success(\"删除成功\");\n      await this.getCatList();\n    },\n  }\n};\n</script>\n\n<style scoped>\n.drawer-form {\n  width: 50%;\n  transform: translateX(50%);\n}\n.form-upload {\n  width: 10vw;\n  height: 100%;\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.avatar-uploader-icon {\n  font-size: 28px;\n  color: #8c939d;\n  width: 178px;\n  height: 178px;\n  line-height: 178px;\n  text-align: center;\n}\n.drawer-button-group {\n}\n</style>\n"]}]}